# Interactive sed tester - preview sed changes before applying them
# Usage: tesed 's/old/new/g' filename
#
# This function:
# 1. Shows a side-by-side diff of original vs. sed-transformed content
# 2. Prompts for confirmation [y/N]
# 3. If confirmed, applies the change and creates a timestamped backup
#
# Example: tesed 's/foo/bar/g' myfile.txt
# Example: tesed 's/foo/bar/g' myfile.txt
function tesed () {
	local CODE=$1
	local FILE=$2

	# Generate sed output once
	local TMP
	TMP=$(mktemp)
	sed "$CODE" "$FILE" >|"$TMP"

	# Choose diff tool
	if command -v wdiff >/dev/null 2>&1;  then
		if command -v colordiff >/dev /null 2>&1; then
			wdiff "$FILE" "$TMP" | colordiff
		else
			wdiff "$FILE" "$TMP"
		fi
	else
		if command -v colordiff >/dev/null 2>&1; then
			diff -y "$FILE" "$TMP" | colordiff --difftype=diffy 
		else
			diff -y "$FILE" "$TMP"
		fi
	fi

	rm -f "$TMP"

	# Prompt for confirmation
	local answer
	read -p '[y/N] ' answer

	# Apply changes if user confirms with 'y', creating a dated backup
	[[ $answer == y ]] && sed -i"~$(date +%x)" "$CODE" "$FILE"
}
